{% extends 'home.html' %}

{% block content %}
{% load static %}

<div class="container">
    <br>
    <div class="card card-default">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-search"></i>
                &nbsp;&nbsp;
                <b>Listado de solicitudes</b>
            </h3>
        </div>
        <!-- /.card-header -->
        <div class="card-body">
            <form class="text-right">
                <input name="q" value="{{q}}" class="form-control form-control-lg" type="text" placeholder="0001">
                <input type="hidden" name="page" value="{{page}}">
                <input type="hidden" name="t" value="{{t}}">
                <a href="{% url 'reporte_solicitudes' %}" class="btn btn-success mt-2">Descargar Excel</a>
                <button type="submit" class="btn btn-secondary mt-2">Buscar folio</button>
            </form>
            <p>
                Filtrar por: &nbsp;
                <a class="btn {% if t == 'todos' %}active{% endif %} btn-outline-primary btn-sm" href="?q={{q}}&page={{page}}&t=todos" role="button">Todos</a>
                <a class="btn {% if t == 'pendiente' %}active{% endif %} btn-outline-primary btn-sm" href="?q={{q}}&page={{page}}&t=pendiente" role="button">Pendientes</a>
                <a class="btn {% if t == 'despachado' %}active{% endif %} btn-outline-primary btn-sm" href="?q={{q}}&page={{page}}&t=despachado" role="button">Despachados</a>
                <a class="btn {% if t == 'cancelado' %}active{% endif %} btn-outline-primary btn-sm" href="?q={{q}}&page={{page}}&t=cancelado" role="button">Cancelados</a>
            </p>
            <p>Total de solicitudes: &nbsp;<b>{{total}}</b></p>
            <table class="table table-striped table-bordered" id="data">
                <thead>
                    <tr>
                        <th scope="col">NÃºmero de folio</th>
                        <th scope="col">Nombre del solicitante</th>
                        <th scope="col">Dirigido a</th>
                        <th scope="col">Dependencia</th>
                        <th scope="col">Motivo</th>
                        <th scope="col">Firmado</th>
                        <th scope="col">Fecha de la solicitud</th>
                        <th scope="col">Estatus</th>
                        {% if perms.folio.option %}
                        <th scope="col">Opciones</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for s in object_list %}
                    <tr>
                        <td>{{ s.folio }}</td>
                        <td>{{s.usuario.get_full_name|default:'No especificado'}}</td>
                        <td>{{ s.nombre }}</td>
                        <td>{{ s.dependencia }}</td>
                        <td>{{ s.motivo }}</td>
                        <td>{{ s.get_firmado_display }}</td>
                        <td>{{ s.fecha_reg }}</td>
                        <td>{{ s.get_estatus_display }}</td>
                        {% if perms.folio.option %}
                        <td class="text-center">
                            {% if s.estatus == 'cancelado' or s.estatus == 'despachado' %}
                            <i class="fas fa-ban fa-1x" style="color: red;"></i></a>
                            {% else %}
                            <a target="_blank" href="{% url 'mod_folio' s.id %}" class="btn btn-primary btn"><i
                                    class="fas fa-edit"></i></a>
                            {% endif %}
                            <input class="form-check-input ml-2" type="checkbox" id="checkboxNoLabel" value="" aria-label="...">
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% include 'base/pagination.html' %}
        </div>
        <div class="card-footer">
        </div>
    </div>
    <br>
</div>
{% endblock %}